{% doc %}
  @prompt
    I want to build a block with a video on the left side and text on the right half. The video should be Oriented for 9:16 video formats and the text on the right side should appear when the user scrolls to this section and also slightly disappear when the user is scrolling further, leaving this section. It should be possible to Upload the video directly to Shopify or through an embedded link. Furthermore we should be able to enable/deactivate Auto-Play of the video., The text should Appear within the videoplaying screen and disappear After 4 seconds, when the User Stays on top the video. The video should not have any boarders and be in full view on an iPhone device, The text should be on the bottom of the screen

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-video-text-section-{{ ai_gen_id }} {
    position: relative;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .ai-video-container-{{ ai_gen_id }} {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  .ai-video-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    max-width: 400px;
    aspect-ratio: 9/16;
    overflow: hidden;
    background-color: #000;
  }

  .ai-video-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-video-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .ai-video-placeholder-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
    color: #ccc;
  }

  .ai-video-empty-state-{{ ai_gen_id }} {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    font-size: 14px;
    color: #666;
    text-align: center;
    pointer-events: none;
  }

  .ai-text-overlay-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: {{ block.settings.overlay_text_color }};
    z-index: 2;
    opacity: 0;
    transition: opacity 0.8s ease;
    padding: 20px;
    max-width: 90%;
    pointer-events: none;
  }

  .ai-text-overlay-{{ ai_gen_id }}.visible {
    opacity: 1;
  }

  .ai-text-overlay-{{ ai_gen_id }}.fade-out {
    opacity: 0;
  }

  .ai-overlay-heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.overlay_heading_size }}px;
    margin: 0 0 10px 0;
    font-weight: 600;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
  }

  .ai-overlay-text-{{ ai_gen_id }} {
    font-size: {{ block.settings.overlay_text_size }}px;
    line-height: 1.4;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
  }

  .ai-overlay-text-{{ ai_gen_id }} p {
    margin: 0 0 8px 0;
  }

  .ai-overlay-text-{{ ai_gen_id }} p:last-child {
    margin-bottom: 0;
  }

  .ai-text-container-{{ ai_gen_id }} {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 40px 20px;
    background: linear-gradient(to top, {{ block.settings.text_background_color }}, transparent);
    opacity: 0;
    transform: translateY(50px);
    transition: opacity 0.8s ease, transform 0.8s ease;
    text-align: center;
    z-index: 3;
  }

  .ai-text-container-{{ ai_gen_id }}.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .ai-text-heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.heading_color }};
    margin: 0 0 20px 0;
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
  }

  .ai-text-content-{{ ai_gen_id }} {
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.6;
    max-width: 800px;
    margin: 0 auto;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
  }

  .ai-text-content-{{ ai_gen_id }} p {
    margin: 0 0 16px 0;
  }

  .ai-text-content-{{ ai_gen_id }} p:last-child {
    margin-bottom: 0;
  }

  @media screen and (max-width: 768px) {
    .ai-video-text-section-{{ ai_gen_id }} {
      min-height: 100vh;
    }

    .ai-video-container-{{ ai_gen_id }} {
      width: 100%;
      height: 100vh;
    }

    .ai-video-wrapper-{{ ai_gen_id }} {
      width: 100%;
      height: 100%;max-width: none;
      aspect-ratio: auto;
    }

    .ai-text-container-{{ ai_gen_id }} {
      padding: 30px 20px;
    }

    .ai-text-heading-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.heading_size }}px * 0.8);
    }

    .ai-text-content-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.text_size }}px * 0.9);
    }

    .ai-overlay-heading-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.overlay_heading_size }}px * 0.8);
    }

    .ai-overlay-text-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.overlay_text_size }}px * 0.9);
    }
  }

  @media screen and (max-width: 480px) {
    .ai-video-wrapper-{{ ai_gen_id }} {
      border-radius: 0;
    }
  }
{% endstyle %}<video-text-section-{{ ai_gen_id }}
  class="ai-video-text-section-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-video-container-{{ ai_gen_id }}">
    <div class="ai-video-wrapper-{{ ai_gen_id }}">
      {% if block.settings.video_file != blank %}
        <video
          class="ai-video-{{ ai_gen_id }}"
          {% if block.settings.autoplay %}autoplay{% endif %}
          muted
          loop
          playsinline
          preload="metadata"
        >
          <source src="{{ block.settings.video_file }}" type="video/mp4">
        </video>
      {% elsif block.settings.video_url != blank %}
        {% if block.settings.video_url contains 'youtube.com' or block.settings.video_url contains 'youtu.be' %}
          {% assign video_id = block.settings.video_url | split: '/' | last | split: '?' | first | split: '&' | first %}
          {% if block.settings.video_url contains 'watch?v=' %}
            {% assign video_id = block.settings.video_url | split: 'watch?v=' | last | split: '&' | first %}
          {% endif %}
          <iframe
            class="ai-video-{{ ai_gen_id }}"
            src="https://www.youtube.com/embed/{{ video_id }}?{% if block.settings.autoplay %}autoplay=1&{% endif %}mute=1&loop=1&playlist={{ video_id }}&controls=0&showinfo=0&rel=0&modestbranding=1"
            frameborder="0"
            allow="autoplay; encrypted-media"
            allowfullscreen
          ></iframe>
        {% elsif block.settings.video_url contains 'vimeo.com' %}
          {% assign video_id = block.settings.video_url | split: '/' | last | split: '?' | first %}
          <iframe
            class="ai-video-{{ ai_gen_id }}"
            src="https://player.vimeo.com/video/{{ video_id }}?{% if block.settings.autoplay %}autoplay=1&{% endif %}muted=1&loop=1&background=1&controls=0"
            frameborder="0"
            allow="autoplay; fullscreen"
            allowfullscreen
          ></iframe>
        {% else %}
          <video
            class="ai-video-{{ ai_gen_id }}"
            {% if block.settings.autoplay %}autoplay{% endif %}
            muted
            loop
            playsinline
            preload="metadata"
          >
            <source src="{{ block.settings.video_url }}" type="video/mp4">
          </video>
        {% endif %}
      {% else %}
        <div class="ai-video-placeholder-{{ ai_gen_id }}">
          {{ 'hero-apparel-1' | placeholder_svg_tag }}<div class="ai-video-empty-state-{{ ai_gen_id }}">
            Add a video file or video URL
          </div>
        </div>
      {% endif %}

      {% if block.settings.overlay_heading != blank or block.settings.overlay_text != blank %}
        <div class="ai-text-overlay-{{ ai_gen_id }}">
          {% if block.settings.overlay_heading != blank %}
            <h2 class="ai-overlay-heading-{{ ai_gen_id }}">{{ block.settings.overlay_heading }}</h2>
          {% endif %}
          {% if block.settings.overlay_text != blank %}
            <div class="ai-overlay-text-{{ ai_gen_id }}">{{ block.settings.overlay_text }}</div>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>

  <div class="ai-text-container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank %}
      <h2 class="ai-text-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
    {% endif %}
    {% if block.settings.text != blank %}
      <div class="ai-text-content-{{ ai_gen_id }}">{{ block.settings.text }}</div>
    {% endif %}
  </div>
</video-text-section-{{ ai_gen_id }}><script>
  (function() {
    class VideoTextSection{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.textContainer = null;
        this.textOverlay = null;
        this.observer = null;
        this.overlayTimeout = null;
        this.isOverlayVisible = false;
      }

      connectedCallback() {
        this.textContainer = this.querySelector('.ai-text-container-{{ ai_gen_id }}');
        this.textOverlay = this.querySelector('.ai-text-overlay-{{ ai_gen_id }}');
        this.setupScrollObserver();
      }

      disconnectedCallback() {
        if (this.observer) {
          this.observer.disconnect();
        }
        if (this.overlayTimeout) {
          clearTimeout(this.overlayTimeout);
        }
      }

      setupScrollObserver() {
        if (!this.textContainer && !this.textOverlay) return;

        const options = {
          root: null,
          rootMargin: '-10% 0px -10% 0px',
          threshold: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1]
        };

        this.observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            const ratio = entry.intersectionRatio;
            if (ratio > 0.1) {
              if (this.textContainer) {
                this.textContainer.classList.add('visible');
                const opacity = Math.min(1, ratio * 1.2);
                const translateY = Math.max(0, 50 - (ratio * 50));
                this.textContainer.style.opacity = opacity;
                this.textContainer.style.transform = `translateY(${translateY}px)`;
              }

              if (this.textOverlay && !this.isOverlayVisible) {
                this.showOverlayText();
              }
            } else {
              if (this.textContainer) {
                this.textContainer.classList.remove('visible');
                this.textContainer.style.opacity = '0';
                this.textContainer.style.transform = 'translateY(50px)';
              }

              if (this.textOverlay) {
                this.hideOverlayText();
              }
            }
          });
        }, options);

        this.observer.observe(this);
      }

      showOverlayText() {
        if (!this.textOverlay || this.isOverlayVisible) return;
        
        this.isOverlayVisible = true;
        this.textOverlay.classList.add('visible');
        this.textOverlay.classList.remove('fade-out');

        if (this.overlayTimeout) {
          clearTimeout(this.overlayTimeout);
        }

        this.overlayTimeout = setTimeout(() => {
          this.hideOverlayText();
        }, 4000);
      }

      hideOverlayText() {
        if (!this.textOverlay) return;
        
        this.isOverlayVisible = false;
        this.textOverlay.classList.add('fade-out');
        this.textOverlay.classList.remove('visible');

        if (this.overlayTimeout) {
          clearTimeout(this.overlayTimeout);
          this.overlayTimeout = null;
        }
      }
    }

    customElements.define('video-text-section-{{ ai_gen_id }}', VideoTextSection{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Video with text overlay",
  "settings": [
    {
      "type": "header",
      "content": "Video"
    },
    {
      "type": "video",
      "id": "video_file",
      "label": "Video file"
    },
    {
      "type": "url",
      "id": "video_url",
      "label": "Video URL"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay video",
      "default": true
    },
    {
      "type": "header",
      "content": "Overlay text"
    },
    {
      "type": "inline_richtext",
      "id": "overlay_heading",
      "label": "Overlay heading",
      "default": "Welcome"
    },
    {
      "type": "richtext",
      "id": "overlay_text",
      "label": "Overlay text",
      "default": "<p>Discover something amazing</p>"
    },
    {
      "type": "range",
      "id": "overlay_heading_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Overlay heading size",
      "default": 28
    },
    {
      "type": "range",
      "id": "overlay_text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Overlay text size",
      "default": 16
    },
    {
      "type": "color",
      "id": "overlay_text_color",
      "label": "Overlay text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Bottom text content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Heading",
      "default": "Your story begins here"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Share your brand story, highlight key features, or describe what makes your products special. This text will animate smoothly as visitors scroll through your page.</p>"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 36
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_background_color",
      "label": "Text background color",
      "default": "rgba(0, 0, 0, 0.6)"
    }
  ],
  "presets": [
    {
      "name": "Video with text overlay"
    }
  ]
}
{% endschema %}