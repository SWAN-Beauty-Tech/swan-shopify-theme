{% doc %}
  @prompt
    Create a search and Filter Function for the Users bring Able to get the right products, Place the Titel, Subtitel centered and the search bar below it as large search bar centered as well and underneath the Filters , Can you make the search bar Frame in the Color like the AI Feature Frame here in Shopify and a light shadow behind so that it Looks like a kind of a 3D effect, Make the Frame Color in the Same Color as the Color of the Titel. , That is not the Right Color Frame - make it in the Same Color as the „Find your perfect product“ title, Make the frame light gray with a shadow around it so it Looks like hovering on top of the page, I dont need the Filters underneath the search bar
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-product-search-filter-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding }}px 20px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-product-search-filter__container-{{ ai_gen_id }} {
    max-width: {{ block.settings.max_width }}px;
    margin: 0 auto;
  }

  .ai-product-search-filter__header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 32px;
  }

  .ai-product-search-filter__title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0 0 8px;
  }

  .ai-product-search-filter__subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.text_color }};
    opacity: 0.8;
    margin: 0;
  }

  .ai-product-search-filter__search-wrapper-{{ ai_gen_id }} {
    max-width: 800px;
    margin: 0 auto 32px;
    position: relative;
  }

  .ai-product-search-filter__search-icon-{{ ai_gen_id }} {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: {{ block.settings.title_color }};
    opacity: 0.5;
    pointer-events: none;
    z-index: 1;
  }

  .ai-product-search-filter__search-{{ ai_gen_id }} {
    width: 100%;
    padding: 18px 20px 18px 56px;
    border: 2px solid #e8e8e8;
    border-radius: {{ block.settings.input_radius }}px;
    font-size: 16px;
    background: #f8f8f8;
    color: {{ block.settings.text_color }};
    box-shadow: 
      0 8px 24px rgba(0, 0, 0, 0.12),
      0 4px 8px rgba(0, 0, 0, 0.08),
      0 2px 4px rgba(0, 0, 0, 0.04);
    transition: all 0.3s ease;
  }

  .ai-product-search-filter__search-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.title_color }};
    background: #ffffff;
    box-shadow: 
      0 12px 32px rgba(0, 0, 0, 0.16),
      0 6px 12px rgba(0, 0, 0, 0.12),
      0 3px 6px rgba(0, 0, 0, 0.08),
      0 0 0 3px {{ block.settings.title_color }}1a;
    transform: translateY(-2px);
  }

  .ai-product-search-filter__search-{{ ai_gen_id }}::placeholder {
    color: {{ block.settings.text_color }};
    opacity: 0.5;
  }

  .ai-product-search-filter__results-info-{{ ai_gen_id }} {
    margin-bottom: 16px;
    font-size: 14px;
    color: {{ block.settings.text_color }};
    opacity: 0.8;
    text-align: center;
  }

  .ai-product-search-filter__grid-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 24px;
    margin-bottom: 24px;
  }

  .ai-product-search-filter__product-card-{{ ai_gen_id }} {
    background-color: {{ block.settings.card_background }};
    border: 1px solid {{ block.settings.border_color }};
    border-radius: {{ block.settings.card_radius }}px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    text-decoration: none;
    color: inherit;
  }

  .ai-product-search-filter__product-card-{{ ai_gen_id }}:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  }

  .ai-product-search-filter__product-image-{{ ai_gen_id }} {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    display: block;
  }

  .ai-product-search-filter__product-image-placeholder-{{ ai_gen_id }} {
    width: 100%;
    aspect-ratio: 1;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-product-search-filter__product-image-placeholder-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
    opacity: 0.3;
  }

  .ai-product-search-filter__product-info-{{ ai_gen_id }} {
    padding: 16px;
  }

  .ai-product-search-filter__product-vendor-{{ ai_gen_id }} {
    font-size: 12px;
    color: {{ block.settings.text_color }};
    opacity: 0.6;
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .ai-product-search-filter__product-title-{{ ai_gen_id }} {
    font-size: 16px;
    color: {{ block.settings.text_color }};
    margin: 0 0 8px;
    font-weight: 600;
    line-height: 1.4;
  }

  .ai-product-search-filter__product-price-{{ ai_gen_id }} {
    font-size: 18px;
    color: {{ block.settings.accent_color }};
    font-weight: 700;
  }

  .ai-product-search-filter__product-type-{{ ai_gen_id }} {
    display: inline-block;
    padding: 4px 8px;
    background-color: {{ block.settings.accent_color }};
    color: #ffffff;
    font-size: 11px;
    border-radius: 4px;
    margin-top: 8px;
  }

  .ai-product-search-filter__no-results-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
    color: {{ block.settings.text_color }};
  }

  .ai-product-search-filter__no-results-icon-{{ ai_gen_id }} {
    width: 80px;
    height: 80px;
    margin: 0 auto 16px;
    opacity: 0.3;
  }

  .ai-product-search-filter__no-results-title-{{ ai_gen_id }} {
    font-size: 24px;
    margin: 0 0 8px;
  }

  .ai-product-search-filter__no-results-text-{{ ai_gen_id }} {
    font-size: 16px;
    opacity: 0.7;
  }

  @media screen and (max-width: 749px) {
    .ai-product-search-filter__grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 16px;
    }
  }
{% endstyle %}

<product-search-filter-{{ ai_gen_id }}
  class="ai-product-search-filter-{{ ai_gen_id }}"
  data-collection="{{ block.settings.collection.handle }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-product-search-filter__container-{{ ai_gen_id }}">
    {% if block.settings.title != blank or block.settings.subtitle != blank %}
      <div class="ai-product-search-filter__header-{{ ai_gen_id }}">
        {% if block.settings.title != blank %}
          <h2 class="ai-product-search-filter__title-{{ ai_gen_id }}">{{ block.settings.title }}</h2>
        {% endif %}
        {% if block.settings.subtitle != blank %}
          <p class="ai-product-search-filter__subtitle-{{ ai_gen_id }}">{{ block.settings.subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="ai-product-search-filter__search-wrapper-{{ ai_gen_id }}">
      <svg
        class="ai-product-search-filter__search-icon-{{ ai_gen_id }}"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input
        type="text"
        class="ai-product-search-filter__search-{{ ai_gen_id }}"
        placeholder="{{ block.settings.search_placeholder }}"
        aria-label="Search products"
      >
    </div>

    <div class="ai-product-search-filter__results-info-{{ ai_gen_id }}"></div>

    <div class="ai-product-search-filter__grid-{{ ai_gen_id }}"></div>

    <div class="ai-product-search-filter__no-results-{{ ai_gen_id }}" style="display: none;">
      <svg
        class="ai-product-search-filter__no-results-icon-{{ ai_gen_id }}"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
        <line x1="8" y1="11" x2="14" y2="11"></line>
      </svg>
      <h3 class="ai-product-search-filter__no-results-title-{{ ai_gen_id }}">No products found</h3>
      <p class="ai-product-search-filter__no-results-text-{{ ai_gen_id }}">Try adjusting your search</p>
    </div>
  </div>
</product-search-filter-{{ ai_gen_id }}>

<script>
  (function() {
    class ProductSearchFilter{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.allProducts = [];
        this.filteredProducts = [];
        this.searchInput = this.querySelector('.ai-product-search-filter__search-{{ ai_gen_id }}');
        this.grid = this.querySelector('.ai-product-search-filter__grid-{{ ai_gen_id }}');
        this.resultsInfo = this.querySelector('.ai-product-search-filter__results-info-{{ ai_gen_id }}');
        this.noResults = this.querySelector('.ai-product-search-filter__no-results-{{ ai_gen_id }}');
      }

      connectedCallback() {
        this.loadProducts();
        this.setupEventListeners();
      }

      setupEventListeners() {
        this.searchInput.addEventListener('input', () => this.filterProducts());
      }

      async loadProducts() {
        const collectionHandle = this.dataset.collection;
        
        if (!collectionHandle) {
          this.allProducts = [];
          this.renderProducts();
          return;
        }

        try {
          const response = await fetch(`/collections/${collectionHandle}/products.json?limit=250`);
          const data = await response.json();
          this.allProducts = data.products;
          this.filterProducts();
        } catch (error) {
          console.error('Error loading products:', error);
          this.allProducts = [];
          this.renderProducts();
        }
      }

      filterProducts() {
        const searchTerm = this.searchInput.value.toLowerCase();

        this.filteredProducts = this.allProducts.filter(product => {
          const matchesSearch = !searchTerm || 
            product.title.toLowerCase().includes(searchTerm) ||
            (product.body_html && product.body_html.toLowerCase().includes(searchTerm)) ||
            (product.vendor && product.vendor.toLowerCase().includes(searchTerm)) ||
            (product.product_type && product.product_type.toLowerCase().includes(searchTerm));

          return matchesSearch;
        });

        this.renderProducts();
      }

      renderProducts() {
        if (this.filteredProducts.length === 0) {
          this.grid.style.display = 'none';
          this.noResults.style.display = 'block';
          this.resultsInfo.textContent = '';
          return;
        }

        this.grid.style.display = 'grid';
        this.noResults.style.display = 'none';
        this.resultsInfo.textContent = `Showing ${this.filteredProducts.length} product${this.filteredProducts.length !== 1 ? 's' : ''}`;

        this.grid.innerHTML = this.filteredProducts.map(product => {
          const price = parseFloat(product.variants[0].price);
          const formattedPrice = new Intl.NumberFormat('{{ block.settings.currency_locale }}', {
            style: 'currency',
            currency: '{{ block.settings.currency_code }}'
          }).format(price);

          const imageHtml = product.images && product.images.length > 0
            ? `<img 
                src="${product.images[0].src}" 
                alt="${product.title}" 
                class="ai-product-search-filter__product-image-{{ ai_gen_id }}"
                loading="lazy"
              >`
            : `<div class="ai-product-search-filter__product-image-placeholder-{{ ai_gen_id }}">
                {{ 'product-1' | placeholder_svg_tag }}
              </div>`;

          return `
            <a href="/products/${product.handle}" class="ai-product-search-filter__product-card-{{ ai_gen_id }}">
              ${imageHtml}
              <div class="ai-product-search-filter__product-info-{{ ai_gen_id }}">
                ${product.vendor ? `<div class="ai-product-search-filter__product-vendor-{{ ai_gen_id }}">${product.vendor}</div>` : ''}
                <h3 class="ai-product-search-filter__product-title-{{ ai_gen_id }}">${product.title}</h3>
                <div class="ai-product-search-filter__product-price-{{ ai_gen_id }}">${formattedPrice}</div>
                ${product.product_type ? `<span class="ai-product-search-filter__product-type-{{ ai_gen_id }}">${product.product_type}</span>` : ''}
              </div>
            </a>
          `;
        }).join('');
      }
    }

    customElements.define('product-search-filter-{{ ai_gen_id }}', ProductSearchFilter{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Product search and filter",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Title",
      "default": "Find Your Perfect Product"
    },
    {
      "type": "inline_richtext",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Search and filter to discover what you need"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search placeholder",
      "default": "Search products..."
    },
    {
      "type": "header",
      "content": "Currency"
    },
    {
      "type": "text",
      "id": "currency_code",
      "label": "Currency code",
      "default": "EUR"
    },
    {
      "type": "text",
      "id": "currency_locale",
      "label": "Currency locale",
      "default": "de-DE"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 800,
      "max": 1600,
      "step": 100,
      "unit": "px",
      "label": "Maximum width",
      "default": 1400
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Section padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 20,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 32
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Subtitle size",
      "default": 16
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent",
      "default": "#dca1a1"
    },
    {
      "type": "color",
      "id": "input_background",
      "label": "Input background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border",
      "default": "#e0e0e0"
    },
    {
      "type": "range",
      "id": "input_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Input border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "card_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Product search and filter"
    }
  ]
}
{% endschema %}
